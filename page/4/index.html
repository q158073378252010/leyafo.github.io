<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    


    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:image" content="http://www.leyafo.com/images/cover.jpg"/>



<meta name="twitter:title" content="Doing Right Things"/>
<meta name="twitter:description" content="this is my description"/>



  	<meta property="og:title" content=" Doing Right Things" />
  	<meta property="og:site_name" content="Doing Right Things" />
  	<meta property="og:url" content="http://www.leyafo.com/" />

    
    <meta property="og:type" content="website" />
    

    <title>
       Doing Right Things
    </title>

    <meta name="description" content="this is my description" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://www.leyafo.com/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://www.leyafo.com/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="http://www.leyafo.com/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://www.leyafo.com/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
      
        <link href="http://www.leyafo.com/index.xml" rel="alternate" type="application/rss+xml" title="Doing Right Things" />
      
    
    <meta name="generator" content="Hugo 0.16" />

    <link rel="canonical" href="http://www.leyafo.com/" />

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="http://www.leyafo.com/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




  <header class="main-header" style="background-image: url(http://www.leyafo.com/images/cover.jpg)">
  


    <nav class="main-nav overlay clearfix">
        
            <a class="blog-logo" href="http://www.leyafo.com/"><img src="http://www.leyafo.com/images/logo.jpeg" alt="Blog Logo" /></a>
        
        
            
              <a class="menu-button icon-feed" href="http://www.leyafo.com/index.xml">&nbsp;&nbsp;Subscribe</a>
            
        
    </nav>
    <div class="vertical">
        <div class="main-header-content inner">
            
            
                <a class="bloglogo" href="https://github.com/leyafo" target="_blank">
                <span class="icon-github" style="color:white;font-size:2em"></span>
                </a>
            &nbsp;
            
            
                <a class="bloglogo" href="https://twitter.com/leyafo" target="_blank">
                    <span class="icon-twitter" style="color:white;font-size:2em"></span>
                </a>
            &nbsp;
            
            
            
            
            

            <h1 class="page-title">Doing Right Things</h1>
            <h2 class="page-description">this is my description</h2>
        </div>
    </div>
    <a class="scroll-down icon-arrow-left" href="#content"><span class="hidden">Scroll Down</span></a>
</header>


<main id="content" class="content" role="main">

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
        
            
        
    

    
    
    

    <div class="extra-pagination inner">
        <nav class="pagination" role="navigation">
	
	    <a class="newer-posts" href="http://www.leyafo.com/page/3/">&larr; Newer Posts</a>
	
	<span class="page-number">Page 4 of 4</span>
	
</nav>

    </div>

    
        
<article class="post post">
    <header class="post-header">
        <h2 class="post-title"><a href="http://www.leyafo.com/post/2013-11-23-tail-recursion-optimization/">尾递归优化</a></h2>
    </header>
    <section class="post-excerpt">
        <p>递归是一个奇特的玩意,能简洁的描述复杂的思考. 一个简单的递归函数: def fibonacci(n): if n &lt;= 1: return 1 return fibonacci(n-1) + fibonacci(n-2) 这个函数实现了一个裴波那契数列.非常简单,代码只有 3 行,但如果跟着函数运行的轨迹走.会发现这个函数背后的调用过程非常的复杂.每次递归都会依赖前面两次计算的结果.随着递归的层级上升,每次都会重新去调用前两次计算产生的结果.为了简化描述,下面是以 fibonacci(5) 模拟递归调用过程. 可以看到,每次递归都会重复前两次的调用过程.实际上这个递归数列并不需要每次都重复去求前两次的结果.如果用压栈的方法,一遍递归就可以搞定了. def fibonacci(n): L = fibonacci.L if n &lt;= 2: return L[-1] #get top else: n2 = L.pop() n1 = L.pop() L.append(n2) #'append' is stack's push L.append(n1+n2) return fibonacci(n-1) fibonacci.L = [1,1] 上面的代码耍了一个小花招.首先先设定好两个初始的计算结果,然后开始递归迭代.与前一版本递归不同的是,前一个递归需要在进入到递归底部后,才开始跳出来计算每一步递归后的结果,直到返回.而后一个递归会在最开始递归进入时就开始计算,进入到递归底部后(也就是 n &lt;= 2)最终的结果就已经计算出来了,直接一层一层返回这个结果就可以了. 为了便于说明下面代码是利用两个变量做中间结果的版本: def fib(n, n1=1, n2=1): if n &lt; 2: return n1 return fib(n-1, n2, n1+n2) 跟上面那个压栈的方式一样.先设定好两个默认的结果,在递归进入时直接将结果计算出来并保存好. <a class="read-more" href="http://www.leyafo.com/post/2013-11-23-tail-recursion-optimization/">&raquo;</a></p>
    </section>
    <footer class="post-meta">
        
        

        
            <img class="author-thumb" src="http://www.leyafo.com/images/logo.jpeg" alt="Author image" nopin="nopin" />
        
        
        
        <time class="post-date" datetime="2013-11-23T11:47:00&#43;08:00">
            23 Nov 2013
        </time>
    </footer>
</article>

    
        
<article class="post post">
    <header class="post-header">
        <h2 class="post-title"><a href="http://www.leyafo.com/post/2013-11-14-on-nosql/">关于NoSQL</a></h2>
    </header>
    <section class="post-excerpt">
        <p>传统关系型数据库,将数据以表结构的方式存储起来.并且所有的数据是基于 ACID1 原则.这种方式存储数据有很明显的缺点.首先,为了保证一致性,基于 ACID2 类型的数据库都是使用事物来保持数据的一致性.也就是说同时只能有一个 client 提交数据.然后,以表结构存储的数据库架构是死的,一个表的列基本上是固定的.如果变化的话会带来很多问题. 比如: 1.我有一种数据,这些数据都是一些 Excle 表格.每个表格的列都不相同.但实际上他们都是一种数据.该如何存储? 2.一个表有 10 列,我想再加一个字段,但这个字段并不是所有数据都需要的. 3.问题同上,如果加 20 个字段呢?再新建一个表?新建的表如何与现有的表关联? 最后关联性数据库还有个不利于分布的弱点,如果数据分布在 N 台分布式的机器上,数据库该如何管理? 为了弥补这些缺点, NoSQL 类数据库诞生了.首先 NoSQL 类数据库有以下特点: schema-less: 数据没有字段的概念,并且数据仓库(关联型数据库的 table )可以随时变化字段. Strong Consistency: 保证数据最终的一致性. High Availability: 保证所有请求数据的客户端都能得到一份数据的 copy. Partition-tolerance: 数据可以不限于分布在同一台机器上. 一般 NoSQL 类数据库存储数据的模型有 4 种方式: Key-Value: 类似于 json 的 key-value 的方式进行数据存储 BigTable: 多维度的 key-value 结构,并且存储方式是分布式,稀疏的3,严格排序的. *Google*很多产品都在用,具有高压缩,高性能,易于查询的特点. Documents: 多个 key-value 结构的数据合为一条数据,每一条数据称为为一个 docment. 并且每个 docment 的 key-value 个数和 key 都可以不同.并且在搜索时,可以以 value 做为关键字来搜索. Graph: 以网状方式将数据存储在一个 dataset 中.适合存储有关联的数据. <a class="read-more" href="http://www.leyafo.com/post/2013-11-14-on-nosql/">&raquo;</a></p>
    </section>
    <footer class="post-meta">
        
        

        
            <img class="author-thumb" src="http://www.leyafo.com/images/logo.jpeg" alt="Author image" nopin="nopin" />
        
        
        
        <time class="post-date" datetime="2013-11-14T09:39:00&#43;08:00">
            14 Nov 2013
        </time>
    </footer>
</article>

    
        
<article class="post post">
    <header class="post-header">
        <h2 class="post-title"><a href="http://www.leyafo.com/post/2013-11-08-python-memory-management/">Python内存管理</a></h2>
    </header>
    <section class="post-excerpt">
        <p>本文基于Python2.7.5源码中的obmalloc.c模块 在 Python 的内部系统中，它的内存管理结构是以金子塔结构呈现的.如下图所示: - 其中-1和-2这两层是跟操作系统来负责的,这里我们略过不表. - 第0层就是我们平常在 C 中使用的 malloc, Python 不会直接使用它,而是会在此基础上做一个内存池. - 第1层是 Python 自己在基于 malloc 的基础上构造的一个内存池. - 第2和第3层是基于第1层的.每当 Python 内部需要使用内存时,会使用第1层做好的分配器来分配内存. 因此第1层是 Python 内部管理内存的主要地方. 作用 在 C 中如果频繁的调用 malloc 与 free 时,是会产生性能问题的.再加上频繁的分配与释放小块的内存会产生内存碎片. Python 在这里主要干的工作有: 1. 如果请求分配的内存在1~256字节之间就使用自己的内存管理系统,否则直接使用 malloc. 2. 这里还是会调用 malloc 分配内存,但每次会分配一块大小为256k的大块内存. 3. 经由内存池登记的内存到最后还是会回收到内存池,并不会调用 C 的 free 释放掉.以便下次使用. 内存池结构 如上图所示,整个黑框格子代表内存池(usedpools).每个单元格存放一个双向链表,每个链表的节点是一个大小为4k的内存块.在这个池中,每个单元格负责管理不同的小块内存.为了便于管理,每个单元格管理的内存块总是以8的倍数为单位.以如下代码为例: PyObject_Malloc(3) 这里我们需要一块大小为3个字节的内存.它将定位到管理大小为8字节的单元格.然后返回大小8字节的内存.在这里 usedpools 有一个令人蛋疼的 ticky. usedpools 在初始化时用了如下代码: #define PTA(x) ((poolp )((uchar *)&amp;(usedpools[2*(x)]) - 2*sizeof(block *))) #define PT(x) PTA(x), PTA(x) static poolp usedpools[2 * ((NB_SMALL_SIZE_CLASSES + 7) / 8) * 8] = { PT(0), PT(1), PT(2), PT(3), PT(4), PT(5), PT(6), PT(7) ...... <a class="read-more" href="http://www.leyafo.com/post/2013-11-08-python-memory-management/">&raquo;</a></p>
    </section>
    <footer class="post-meta">
        
        

        
            <img class="author-thumb" src="http://www.leyafo.com/images/logo.jpeg" alt="Author image" nopin="nopin" />
        
        
        
        <time class="post-date" datetime="2013-11-08T11:25:00&#43;08:00">
            8 Nov 2013
        </time>
    </footer>
</article>

    

    <nav class="pagination" role="navigation">
	
	    <a class="newer-posts" href="http://www.leyafo.com/page/3/">&larr; Newer Posts</a>
	
	<span class="page-number">Page 4 of 4</span>
	
</nav>


</main>

    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Doing Right Things</a> All rights reserved by Leyafo</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://www.leyafo.com/js/jquery.js"></script>
    <script type="text/javascript" src="http://www.leyafo.com/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://www.leyafo.com/js/index.js"></script>
    <script id='nodebb-comments-script' ourl="https://v2mm.tech" ocid="49" blogger='leyafo' src="https://v2mm.tech/plugins/nodebb-plugin-blog-comments2/lib/simple-hugo.js"></script>
    
</body>
</html>

